<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remi AI - Generate Image</title>
</head>
<body>
    <h1>Generate Image</h1>
    <input type="text" id="prompt" placeholder="Enter prompt (e.g., A cat in a hat)">
    <button onclick="generateImage()">Generate Image</button>
    <div id="results"></div>
    <p id="error"></p>
    <script>
        async function generateImage() {
            const prompt = document.getElementById('prompt').value;
            const userEmail = localStorage.getItem('userEmail') || 'anonymous';
            document.getElementById('error').textContent = '';
            document.getElementById('results').innerHTML = '';
            try {
                const response = await fetch('https://remiai3-remi-ai-demo-backend.hf.space/gradio_api/call/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ data: [prompt, userEmail] })
                });
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const data = await response.json();
                if (!data.event_id) throw new Error('No event ID returned');
                const eventId = data.event_id;
                let result = null;
                for (let i = 0; i < 30; i++) {
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    const pollResponse = await fetch(`https://remiai3-remi-ai-demo-backend.hf.space/gradio_api/call/predict/${eventId}`);
                    if (!pollResponse.ok) throw new Error(`Poll error! Status: ${pollResponse.status}`);
                    result = await pollResponse.json();
                    if (result.data && result.data[0]) break;
                }
                if (!result.data || !result.data[0]) throw new Error('No image data');
                if (result.data[1]) throw new Error(result.data[1]);
                const img = document.createElement('img');
                img.src = `data:image/png;base64,${result.data[0]}`;
                document.getElementById('results').appendChild(img);
            } catch (error) {
                document.getElementById('error').textContent = 'Error: ' + error.message;
            }
        }
    </script>
</body>
</html>